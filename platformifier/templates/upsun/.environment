{{- if .Database }}# Set database environment variables
export DB_HOST="${{ .DatabaseUpper }}_HOST"
export DB_PORT="${{ .DatabaseUpper }}_PORT"
export DB_PATH="${{ .DatabaseUpper }}_PATH"
export DB_USERNAME="${{ .DatabaseUpper }}_USERNAME"
export DB_PASSWORD="${{ .DatabaseUpper }}_PASSWORD"
export DB_SCHEME="${{ .DatabaseUpper }}_SCHEME"
export DATABASE_URL="${DB_SCHEME}://${DB_USERNAME}:${DB_PASSWORD}@${DB_HOST}:${DB_PORT}/${DB_PATH}"
{{- end -}}
{{- if eq .Stack.Name "laravel" }}

# Set Laravel-specific database environment variables
export DB_CONNECTION="$DB_SCHEME"
export DB_DATABASE="$DB_PATH"
{{- end -}}
{{- if .Cache }}

# Set Cache environment variables
export CACHE_HOST="${{ .CacheUpper }}_HOST"
export CACHE_PORT="${{ .CacheUpper }}_PORT"
export CACHE_SCHEME="${{ .CacheUpper }}_SCHEME"
export CACHE_URL="${CACHE_SCHEME}://${CACHE_HOST}:${CACHE_PORT}"
{{- end -}}
{{- if or (eq .Cache "redis") (eq .Cache "redis_persistent") }}

# Set Redis environment variables
export REDIS_URL="$CACHE_URL"
{{- end -}}

{{- if eq .Stack.Name "django" -}}
# Celery
# ------------------------------------------------------------------------------
export CELERY_BROKER_URL="$CACHE_URL"
{{- end -}}

{{- if eq .Stack.Name "laravel" }}
export APP_NAME={{ .Name }}
export APP_ENV=production
export APP_DEBUG=false

export CACHE_DRIVER=redis
export SESSION_DRIVER=redis
export REDIS_CLIENT=phpredis
# export REDIS_HOST
# export REDIS_PORT

export APP_KEY="${{ .Assets.EnvPrefix }}_PROJECT_ENTROPY"

export APP_URL=$(echo $${{ .Assets.EnvPrefix }}_ROUTES | base64 --decode | jq -r 'to_entries[] | select(.value.primary == true) | .key')

export SESSION_SECURE_COOKIE=1

export MAIL_HOST="${{ .Assets.EnvPrefix }}_SMTP_HOST"
export MAIL_DRIVER=smtp
export MAIL_PORT=25
{{- end -}}